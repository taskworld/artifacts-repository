# artifacts-repository
[WIP] A simple artifact repository (a.k.a. binary repository) for frontend apps backed by Firebase Firestore and Firebase Storage.

## Background

Our frontend app has to be deployed for multiple environments,
e.g. deployed to CDN (cloud), packaged into mobile/desktop apps,
deployed to VPCs or on-premises customers.

In the past, we had to download the source code and run `webpack` for each environment.
This is time consuming and prone to errors.
What if we could use the single webpack bundle and deploy it everywhere?

We use a very abstract definition of an artifact â€” just a `.tar` file.

## Architecture

1.  A **project** contains multiple **artifacts**.

2.  An **artifact**:

    - Is a `.tar.gz` tarball.

    - Contains the build output, e.g. the built assets such as HTML, JS, CSS and related resources.
    
    - May also contain information about the build, e.g. webpack stats, test reports, etc. This allows us to analyze.

    - The same artifact can be deployed to a web server, CDN, on-premises, or packaged into a mobile or desktop app.

    - Contains `info.json` file that can be describes the artifact.

    - Should be generated by CI but can be generated manually as well.

3.  When a project is built by CI, it pushes the artifact to the repository.

4.  Deployment scripts can download the artifact from this repository and use it to deploy to the target environment.

5.  This project contains multiple components:

    1.  A binary storage, hosted on Firebase Cloud Storage.

    2.  A database, hosted on Firebase Cloud Firestore.

    3.  An API that can be used to access the binary storage and database.

    4.  A CLI that can be invoked using `npx` that will interface with the API.

## Data model

### API key

- Used to interface with the API

### Project

- Identified by key

- Contains artifacts

### Artifact

- Belongs to a project

- Identified by key

- Key should be monotonically increasing (for easy ordering)

- Attributes:

  | Attribute | Info |
  | --------- | ---- |
  | sha | Commit ID associated with the artifact. |
  | branch | Branch name when artifact was built. |
  | buildURL | URL to the build. In form of `https://circleci.com/gh/owner/repo/build/number` (`$CIRCLE_BUILD_URL`) |
  | pullRequest | URL to the pull request. In form of `https://github.com/owner/repo/pull/number` (`$CIRCLE_PULL_REQUEST`) |
  | timestamp | Timestamp when the artifact was uploaded. |
  | duration | How long it took to build the artifact. |
  | tarball | Storage identifier of the artifact. In form of `gs://bucket/path/to/file.tar.gz` |









